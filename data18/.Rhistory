ontario_library_stats_2001,
ontario_library_stats_2002,
ontario_library_stats_2003,
ontario_library_stats_2004,
ontario_library_stats_2005,
ontario_library_stats_2006,
ontario_library_stats_2007,
ontario_library_stats_2008,
ontario_library_stats_2009,
ontario_library_stats_2010)
#sum titles held
libraries2000_2010$`Titles Held (Total - English Language)`<-libraries2000_2010$`Titles Held (Circulating - English Language)`+libraries2000_2010$`Titles Held (Reference - English Language)`
libraries2000_2010$`Titles Held (Total - French Language)`<-libraries2000_2010$`Titles Held (Circulating - French Language)`+libraries2000_2010$`Titles Held (Reference - French Language)`
libraries2000_2010$`Titles Held (Total - Other Language)`<-libraries2000_2010$`Titles Held (Circulating - Other Language)`+libraries2000_2010$`Titles Held (Reference - Other Language)`
#sum Volumes held
libraries2000_2010$`Volumes Held (Total - English Language)`<-libraries2000_2010$`Volumes Held (Circulating - English Language)`+libraries2000_2010$`Volumes Held (Reference - English Language)`
libraries2000_2010$`Volumes Held (Total - French Language)`<-libraries2000_2010$`Volumes Held (Circulating - French Language)`+libraries2000_2010$`Volumes Held (Reference - French Language)`
libraries2000_2010$`Volumes Held (Total - Other Language)`<-libraries2000_2010$`Volumes Held (Circulating - Other Language)`+libraries2000_2010$`Volumes Held (Reference - Other Language)`
#sum CDs
libraries2000_2010$`# of CD ROM Titles (Total - English Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - English Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - English Language)`+libraries2000_2010$`# of CD ROM Titles (Periodicals - English Language)`
libraries2000_2010$`# of CD ROM Titles (Total - French Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - French Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - French Language)`+libraries2000_2010$`# of CD ROMs Titles (Periodicals - French Language)`
libraries2000_2010$`# of CD ROM Titles (Total - Other Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - Other Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - Other Language)`+libraries2000_2010$`# of CD ROM Titles (Periodicals - Other Language)`
#sum CD copies
libraries2000_2010$`# of copies of CD ROMs (Total - English Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - English Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - English Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - English Language)`
libraries2000_2010$`# of copies of CD ROMs (Total - French Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - French Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - French Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - French Language)`
libraries2000_2010$`# of copies of CD ROMs (Total - Other Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - Other Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - Other Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - Other Language)`
#sum databases and subscriptions
libraries2000_2010$`# of Databases (Total - English Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - English Language)`+libraries2000_2010$`# of Databases (Reference - English Language)`
libraries2000_2010$`# of Databases (Total - French Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - French Language)`+libraries2000_2010$`# of Databases (Reference - French Language)`
libraries2000_2010$`# of Databases (Total - Other Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - Other Language)`+libraries2000_2010$`# of Databases (Reference - Other Language)`
#manually generated field mapping between old and new data format (this was a real pain to make)
temp<-c("Library","LibID","Year","Ontario Library Service (OLS) Region","Library Service Type","Mailing Address","Street Address","City",NA,"Postal Code","Library Web Site Address","# of Active Library Cardholders","Net Balance brought forward amount",NA,NA,NA,"Provincial Operating Funding","Local Operating Grant","Contract Revenue",NA,NA,NA,NA,NA,NA,NA,NA,NA,"Project Grants","Donations","Self-generated Revenue","Debt Services and Reserve Fund Revenues","Other operating revenue","Total Operating Revenues","Provincial capital revenues","Federal capital revenues","Local capital revenues","Other capital revenues","Total Capital Revenues",NA,"General materials expenditure","Electronic materials expenditure","Staffing expenditure","Staff Training expenditure","Facilities/Utilities","Telephone and Fax","Dedicated Internet Connectivity Costs","Computer Services","Debt Charges and Transfers to Reserve Funds","Funds returned to government sources","Contract payment made to library boards for library services","Other expenditures","Total Operating Expenditures","Total Capital Expenditures",NA,"Titles Held (Total - English Language)","Titles Held (Total - French Language)","Titles Held (Total - Other Language)",NA,"Volumes Held (Total - English Language)","Volumes Held (Total - French Language)","Volumes Held (Total - Other Language)",NA,NA,"# of CD ROM Titles (Total - English Language)","# of CD ROM Titles (Total - French Language)","# of CD ROM Titles (Total - Other Language)",NA,"# of copies of CD ROMs (Total - English Language)","# of copies of CD ROMs (Total - French Language)","# of copies of CD ROMs (Total - Other Language)",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"Titles Held (Periodicals - English Language)","Titles Held (Periodicals - French Language)","Titles Held (Periodicals - Other Language)",NA,NA,"# of Databases (Total - English Language)","# of Databases (Total - French Language)","# of Databases (Total - Other Language)",NA,"# of individual electronic periodical titles (English Language)","# of individual electronic periodical titles (French Language)","# of individual electronic periodical titles (Other Language)",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of hours per week in an FTE","Librarians (Full Time - # of people)","Library Technicians (Full Time - # of people)",NA,"EXCEL Graduates  (Full Time - # of people)","Other staff (Full Time - # of people)","Volunteers (Full Time - # of people)","Librarians (Part Time - # of people)","Librarians (Part Time - Hours worked)","Library Technicians (Part Time - # of people)","Library Technicians (Part Time - Hours worked)",NA,NA,"EXCEL Graduates (Part Time - # of people)","EXCEL Graduates (Part Time - Hours worked)","Other staff (Part Time - # of people)","Other staff (Part Time - Hours worked)","Volunteers (Part Time - # of people)","Volunteers (Part Time - Hours worked)",NA,NA,"# of Public access workstations")
temp2<-c("Workstations with internet access","Workstations with OPAC access",NA,NA,"Automated catalogue available","Does your library provide wireless Internet connection",NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of Main Libraries","Main Library - total hours open per week","# of Branches open >= 12 hours per week","Branches open >= 12 hours per week - total hours open per week","# of Branches open < 12 hours per week","Branches open < 12 hours per week - total hours open per week","# of Bookmobile stops","Bookmobile hours per week","# of Deposit Stations","Deposit Station hours per week","# of Bookmobiles","Total Annual Direct Circulation","# of programs held annually","Annual program attendance",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of requests made to other libraries","# of items borrowed","# of requests received from other libraries","# of items lent","Typical Week - Direct circulation",NA,NA,"Typical Week - Materials use in library","Typical Week -  # of people using library workstations","Typical Week -  # of times electronic databases accessed","No of people using public library wireless connection",NA,"Typical Week -  # of standard reference transactions","Typical Week -  # of electronic reference transactions",NA,NA,NA,NA,"Typical Week -  # of library visits made in person","Typical Week -  # of electronic library visits",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"Population (Resident)","Population (Contracting)","Households (Contracting)","Households (Resident)")
temp3<-c(temp,temp2)
names_lookup<-data.frame("abbreviated"=c("Library Full Name","Library Number","Survey Year From","A1.3","A1.4","A1.5","A1.9","A1.10","A1.11","A1.12","A1.13","A1.14","B1.1","B2.1.1","B2.1.2","B2.1.3","B2.1.4","B2.2","B2.3","B2.4.1.02","B2.4.1.03","B2.4.1.04","B2.4.1.05","B2.4.1.07","B2.4.1.08","B2.4.1.10","B2.4.1.11","B2.4.1.99","B2.4.1a","B2.5","B2.6","B2.7","B2.8","B2.9","B3.1","B3.2","B3.3","B3.4","B3.5","B4.01","B4.01.1","B4.01.2","B4.02","B4.03","B4.04","B4.05.1","B4.05.2","B4.06","B4.07","B4.08","B4.09","B4.10","B5.0","B6.0","C0.0","C0.1.E","C0.1.F","C0.1.O","C0.1.T","C0.2.E","C0.2.F","C0.2.O","C0.2.T","C0.3","C0.3.1.E","C0.3.1.F","C0.3.1.O","C0.3.1.T","C0.3.2.E","C0.3.2.F","C0.3.2.O","C0.3.2.T","C0.3.3.E","C0.3.3.F","C0.3.3.O","C0.3.3.T","C0.3.4.E","C0.3.4.F","C0.3.4.O","C0.3.4.T","C0.4.E","C0.4.F","C0.4.O","C0.4.T","C0.5.E","C0.5.F","C0.5.O","C0.5.T","C3.0","C3.1.E","C3.1.F","C3.1.O","C3.1.T","C3.2","C3.2.0.E","C3.2.0.F","C3.2.0.O","C3.2.0.T","C3.2.4.E","C3.2.4.F","C3.2.4.O","C3.2.4.T","C4.0","C4.1","C4.1","C4.1","C4.2","C4.3","C4.3.02","C4.3.03","C4.3.04","C4.3.05","C4.3.06","C4.3.07","C4.3.08","C4.3.09","C5.0","C5.1","C5.2","C5.3","D1.0.H","D1.1.1.C","D1.1.2.C","D1.1.3.1.C","D1.1.3.C","D1.1.4.C","D1.1.5.C","D1.2.1.C","D1.2.1.H","D1.2.2.C","D1.2.2.H","D1.2.3.1.C","D1.2.3.1.H","D1.2.3.C","D1.2.3.H","D1.2.4.C","D1.2.4.H","D1.2.5.C","D1.2.5.H","D1.3","D1.3.1","E1.1","E1.1.1","E1.1.2","E1.1.4","E1.2","E2.1","E2.3","E2.4","E2.4","E2.4","E2.5","E2.6","E2.6","E2.6","E2.7","E2.8","E3.1.SPC","E3.1.SPH","E3.2.SPC","E3.2.SPH","E3.3.SPC","E3.3.SPH","E3.4.SPC","E3.4.SPH","E3.5.SPC","E3.5.SPH","E3.6.SPC","F1.0","F2.1.P","F2.2.A","F2.301.Attendance","F2.301.Programs","F2.302.Attendance","F2.302.Programs","F2.303.Attendance","F2.303.Programs","F2.304.Attendance","F2.304.Programs","F2.305.Attendance","F2.305.Programs","F2.306.Attendance","F2.306.Programs","F2.307.Attendance","F2.307.Programs","F2.308.Attendance","F2.308.Programs","F2.309.Attendance","F2.309.Programs","F2.310.Attendance","F2.310.Programs","F2.311.Attendance","F2.311.Programs","F2.312","F2.312","F2.313.Attendance","F2.313.Programs","F2.314.Attendance","F2.314.Programs","F2.315.Attendance","F2.315.Programs","F2.316.Attendance","F2.316.Programs","F2.317.Attendance","F2.317.Programs","F2.318.Attendance","F2.318.Programs","F2.319.Attendance","F2.319.Programs","F2.320.Attendance","F2.320.Programs","F2.321.Attendance","F2.321.Programs","F2.322.Attendance","F2.322.Programs","F2.4","F2.4.1","F3.1.1","F3.1.2","F3.2.1","F3.2.2","G1.1.1.W","G1.1.2.W","G1.1.3.W","G1.2.1.W","G1.3.1.W","G1.3.2.W","G1.3.3.W","G1.3.4","G1.4.1.W","G1.4.2.W","G1.4.3.W","G1.4.4.W","G1.4.5.W","G1.4.6.W","G1.5.1.W","G1.5.2.W","G1.5.3.W","H1.1.1.01","H1.1.1.02","H1.1.1.03","H1.1.1.04","H1.1.1.05","H1.1.1.06","H1.1.1.07","H1.1.1.08","H1.1.1.92","H1.2.1.F","H1.2.1.T","H1.2.2","H1.3.1.F","H1.3.1.T","H1.3.2.11","H1.3.2.12","H1.3.2.13","H1.3.2.14","H1.3.2.15","H1.3.2.16","H1.3.2.17","H1.3.2.18","H1.3.2.19","H1.3.2.20","H1.3.2.90","H1.4.1.F","H1.4.1.T","H1.4.2","H1.4.3.21","H1.4.3.22","H1.4.3.23","H1.4.3.24","H1.4.3.25","H1.4.3.26","H1.4.3.93","H1.5.1.F","H1.5.1.T","H1.5.2","H1.5.3.40","H1.5.3.41","H1.5.3.42","H1.5.3.43","H1.5.3.44","H1.5.3.94","H1.5.4","H1.7.1.F","H1.7.1.T","H1.7.2.31","H1.7.2.32","H1.7.2.34","H1.7.2.35","H1.7.2.36","H1.7.2.91","H1.8.1.F","H1.8.1.T","H1.8.2.PC","H1.8.3.F","H1.8.3.T","H1.8.4.TN","H1.9.1.F","H1.9.1.T","H1.9.2.51","H1.9.2.52","H1.9.2.95","P1.1","P1.2","P2.1","P2.2"),
"oldformat"=temp3,stringsAsFactors = F)
#rename the old data fields with short versions of the new field names (to be generated later on), where possible
names(libraries2000_2010)[names(libraries2000_2010) %in% names_lookup$oldformat]<-as.character(names_lookup$abbreviate[match(names(libraries2000_2010)[names(libraries2000_2010) %in% names_lookup$oldformat],names_lookup$oldformat)])
#convert column E2.1 to an integer for consistency with more recent data format
libraries2000_2010$E2.1[libraries2000_2010$E2.1=="Yes"]<-1
libraries2000_2010$E2.1[libraries2000_2010$E2.1=="No"]<-0
libraries2000_2010$E2.1<-as.integer(libraries2000_2010$E2.1)
#get list of long field names
longnames<-c(names(ontario_library_stats_2011),setdiff(names(ontario_library_stats_2012),names(ontario_library_stats_2011)))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2013),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2014),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2015),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2016),longnames))
#shorten the column names for data from 2011-2016
names(ontario_library_stats_2011)[4:length(names(ontario_library_stats_2011))]<-sapply(strsplit(names(ontario_library_stats_2011)[4:length(names(ontario_library_stats_2011))], " "), "[", 1)
names(ontario_library_stats_2012)[4:length(names(ontario_library_stats_2012))]<-sapply(strsplit(names(ontario_library_stats_2012)[4:length(names(ontario_library_stats_2012))], " "), "[", 1)
names(ontario_library_stats_2013)[4:length(names(ontario_library_stats_2013))]<-sapply(strsplit(names(ontario_library_stats_2013)[4:length(names(ontario_library_stats_2013))], " "), "[", 1)
names(ontario_library_stats_2014)[4:length(names(ontario_library_stats_2014))]<-sapply(strsplit(names(ontario_library_stats_2014)[4:length(names(ontario_library_stats_2014))], " "), "[", 1)
names(ontario_library_stats_2015)[4:length(names(ontario_library_stats_2015))]<-sapply(strsplit(names(ontario_library_stats_2015)[4:length(names(ontario_library_stats_2015))], " "), "[", 1)
names(ontario_library_stats_2016)[4:length(names(ontario_library_stats_2016))]<-sapply(strsplit(names(ontario_library_stats_2016)[4:length(names(ontario_library_stats_2016))], " "), "[", 1)
#produce lookup table for short names vs. long names
new_names_lookup<-data.frame(full_names=longnames,short_names=c(longnames[1:3],sapply(strsplit(longnames[4:length(longnames)], " "), "[", 1)))
#merge library data from 2011-2016
libraries2011_2016<-bind_rows(ontario_library_stats_2011,
ontario_library_stats_2012,
ontario_library_stats_2013,
ontario_library_stats_2014,
ontario_library_stats_2015,
ontario_library_stats_2016)
#convert library number to integer for consistency with older years data
libraries2011_2016$`Library Number`<-as.integer(substr(libraries2011_2016$`Library Number`,2,5))
#merge the library data from 2000-2010 and 2011-2016
libraries2000_2016<-bind_rows(libraries2000_2010,libraries2011_2016)
#aggregate(sum) library data by city and year
libraries2000_2016_by_city<-libraries2000_2016[,-c(1:2,4:8,10:12,17:19,22,114,158)] %>% group_by(`Survey Year From`,A1.10) %>% summarise_all(sum)
#replace the original full field names
names(libraries2000_2016_by_city)[names(libraries2000_2016_by_city) %in% new_names_lookup$short_names]<-as.character(new_names_lookup$full_names[match(names(libraries2000_2016_by_city)[names(libraries2000_2016_by_city) %in% new_names_lookup$short_names],new_names_lookup$short_names)])
#I haven't removed any unnecessary columns or combined any columns because you may which to use the data as-is for Assignment 3 (it's your call)
#install packages if not already installed
#install.packages("readr")
#instal.packages("dplyr")
#load readr package for importing data files
library(readr)
#load dplyr package for manipulating data
library("dplyr")
#set working directory to the location where your data files are stored
#setwd("enter the file path here")
#import each data file
ontario_library_stats_1999 <- read_csv("ontario_library_stats_1999.csv")
ontario_library_stats_2000 <- read_csv("ontario_library_stats_2000.csv")
ontario_library_stats_2001 <- read_csv("ontario_library_stats_2001.csv")
ontario_library_stats_2002 <- read_csv("ontario_library_stats_2002.csv")
ontario_library_stats_2003 <- read_csv("ontario_library_stats_2003.csv")
ontario_library_stats_2004 <- read_csv("ontario_library_stats_2004.csv")
ontario_library_stats_2005 <- read_csv("ontario_library_stats_2005.csv")
ontario_library_stats_2006 <- read_csv("ontario_library_stats_2006.csv")
ontario_library_stats_2007 <- read_csv("ontario_library_stats_2007.csv")
ontario_library_stats_2008 <- read_csv("ontario_library_stats_2008.csv")
ontario_library_stats_2009 <- read_csv("ontario_library_stats_2009.csv")
ontario_library_stats_2010 <- read_csv("ontario_library_stats_2010.csv")
ontario_library_stats_2011 <- read_csv("ontario_public_library_statistics_2011_open_data_may_22_csv_final.csv")
ontario_library_stats_2012 <- read_csv("ontario_public_library_statistics_2012_open_data_may_22_2015_csv_final_9.csv")
ontario_library_stats_2013 <- read_csv("ontario_public_library_statistics_2013_open_data_may_22_2015_csv_final.csv")
ontario_library_stats_2014 <- read_csv("ontario_public_library_statistics_2014_open_data_csv_february_17_2016.csv",skip=1) #first row needs to be skipped to import headers properly
ontario_library_stats_2015 <- read_csv("2015_ontario_public_library_statistics_open_data_dec_2017rev.csv")
ontario_library_stats_2016 <- read_csv("ontario_public_library_statistics_open_data_2016.csv")
#ignore 1999 data file - it's too much of a mess
#rename column 1 of 2000 data file for consistency with 2001-2010
names(ontario_library_stats_2000)[names(ontario_library_stats_2000)=="0"]<-"LibID"
#merge library data from 2000-2010
libraries2000_2010<-bind_rows(ontario_library_stats_2000,
ontario_library_stats_2001,
ontario_library_stats_2002,
ontario_library_stats_2003,
ontario_library_stats_2004,
ontario_library_stats_2005,
ontario_library_stats_2006,
ontario_library_stats_2007,
ontario_library_stats_2008,
ontario_library_stats_2009,
ontario_library_stats_2010)
#sum titles held
libraries2000_2010$`Titles Held (Total - English Language)`<-libraries2000_2010$`Titles Held (Circulating - English Language)`+libraries2000_2010$`Titles Held (Reference - English Language)`
libraries2000_2010$`Titles Held (Total - French Language)`<-libraries2000_2010$`Titles Held (Circulating - French Language)`+libraries2000_2010$`Titles Held (Reference - French Language)`
libraries2000_2010$`Titles Held (Total - Other Language)`<-libraries2000_2010$`Titles Held (Circulating - Other Language)`+libraries2000_2010$`Titles Held (Reference - Other Language)`
#sum Volumes held
libraries2000_2010$`Volumes Held (Total - English Language)`<-libraries2000_2010$`Volumes Held (Circulating - English Language)`+libraries2000_2010$`Volumes Held (Reference - English Language)`
libraries2000_2010$`Volumes Held (Total - French Language)`<-libraries2000_2010$`Volumes Held (Circulating - French Language)`+libraries2000_2010$`Volumes Held (Reference - French Language)`
libraries2000_2010$`Volumes Held (Total - Other Language)`<-libraries2000_2010$`Volumes Held (Circulating - Other Language)`+libraries2000_2010$`Volumes Held (Reference - Other Language)`
#sum CDs
libraries2000_2010$`# of CD ROM Titles (Total - English Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - English Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - English Language)`+libraries2000_2010$`# of CD ROM Titles (Periodicals - English Language)`
libraries2000_2010$`# of CD ROM Titles (Total - French Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - French Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - French Language)`+libraries2000_2010$`# of CD ROMs Titles (Periodicals - French Language)`
libraries2000_2010$`# of CD ROM Titles (Total - Other Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - Other Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - Other Language)`+libraries2000_2010$`# of CD ROM Titles (Periodicals - Other Language)`
#sum CD copies
libraries2000_2010$`# of copies of CD ROMs (Total - English Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - English Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - English Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - English Language)`
libraries2000_2010$`# of copies of CD ROMs (Total - French Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - French Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - French Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - French Language)`
libraries2000_2010$`# of copies of CD ROMs (Total - Other Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - Other Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - Other Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - Other Language)`
#sum databases and subscriptions
libraries2000_2010$`# of Databases (Total - English Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - English Language)`+libraries2000_2010$`# of Databases (Reference - English Language)`
libraries2000_2010$`# of Databases (Total - French Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - French Language)`+libraries2000_2010$`# of Databases (Reference - French Language)`
libraries2000_2010$`# of Databases (Total - Other Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - Other Language)`+libraries2000_2010$`# of Databases (Reference - Other Language)`
#manually generated field mapping between old and new data format (this was a real pain to make)
temp<-c("Library","LibID","Year","Ontario Library Service (OLS) Region","Library Service Type","Mailing Address","Street Address","City",NA,"Postal Code","Library Web Site Address","# of Active Library Cardholders","Net Balance brought forward amount",NA,NA,NA,"Provincial Operating Funding","Local Operating Grant","Contract Revenue",NA,NA,NA,NA,NA,NA,NA,NA,NA,"Project Grants","Donations","Self-generated Revenue","Debt Services and Reserve Fund Revenues","Other operating revenue","Total Operating Revenues","Provincial capital revenues","Federal capital revenues","Local capital revenues","Other capital revenues","Total Capital Revenues",NA,"General materials expenditure","Electronic materials expenditure","Staffing expenditure","Staff Training expenditure","Facilities/Utilities","Telephone and Fax","Dedicated Internet Connectivity Costs","Computer Services","Debt Charges and Transfers to Reserve Funds","Funds returned to government sources","Contract payment made to library boards for library services","Other expenditures","Total Operating Expenditures","Total Capital Expenditures",NA,"Titles Held (Total - English Language)","Titles Held (Total - French Language)","Titles Held (Total - Other Language)",NA,"Volumes Held (Total - English Language)","Volumes Held (Total - French Language)","Volumes Held (Total - Other Language)",NA,NA,"# of CD ROM Titles (Total - English Language)","# of CD ROM Titles (Total - French Language)","# of CD ROM Titles (Total - Other Language)",NA,"# of copies of CD ROMs (Total - English Language)","# of copies of CD ROMs (Total - French Language)","# of copies of CD ROMs (Total - Other Language)",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"Titles Held (Periodicals - English Language)","Titles Held (Periodicals - French Language)","Titles Held (Periodicals - Other Language)",NA,NA,"# of Databases (Total - English Language)","# of Databases (Total - French Language)","# of Databases (Total - Other Language)",NA,"# of individual electronic periodical titles (English Language)","# of individual electronic periodical titles (French Language)","# of individual electronic periodical titles (Other Language)",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of hours per week in an FTE","Librarians (Full Time - # of people)","Library Technicians (Full Time - # of people)",NA,"EXCEL Graduates  (Full Time - # of people)","Other staff (Full Time - # of people)","Volunteers (Full Time - # of people)","Librarians (Part Time - # of people)","Librarians (Part Time - Hours worked)","Library Technicians (Part Time - # of people)","Library Technicians (Part Time - Hours worked)",NA,NA,"EXCEL Graduates (Part Time - # of people)","EXCEL Graduates (Part Time - Hours worked)","Other staff (Part Time - # of people)","Other staff (Part Time - Hours worked)","Volunteers (Part Time - # of people)","Volunteers (Part Time - Hours worked)",NA,NA,"# of Public access workstations")
temp2<-c("Workstations with internet access","Workstations with OPAC access",NA,NA,"Automated catalogue available","Does your library provide wireless Internet connection",NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of Main Libraries","Main Library - total hours open per week","# of Branches open >= 12 hours per week","Branches open >= 12 hours per week - total hours open per week","# of Branches open < 12 hours per week","Branches open < 12 hours per week - total hours open per week","# of Bookmobile stops","Bookmobile hours per week","# of Deposit Stations","Deposit Station hours per week","# of Bookmobiles","Total Annual Direct Circulation","# of programs held annually","Annual program attendance",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of requests made to other libraries","# of items borrowed","# of requests received from other libraries","# of items lent","Typical Week - Direct circulation",NA,NA,"Typical Week - Materials use in library","Typical Week -  # of people using library workstations","Typical Week -  # of times electronic databases accessed","No of people using public library wireless connection",NA,"Typical Week -  # of standard reference transactions","Typical Week -  # of electronic reference transactions",NA,NA,NA,NA,"Typical Week -  # of library visits made in person","Typical Week -  # of electronic library visits",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"Population (Resident)","Population (Contracting)","Households (Contracting)","Households (Resident)")
temp3<-c(temp,temp2)
names_lookup<-data.frame("abbreviated"=c("Library Full Name","Library Number","Survey Year From","A1.3","A1.4","A1.5","A1.9","A1.10","A1.11","A1.12","A1.13","A1.14","B1.1","B2.1.1","B2.1.2","B2.1.3","B2.1.4","B2.2","B2.3","B2.4.1.02","B2.4.1.03","B2.4.1.04","B2.4.1.05","B2.4.1.07","B2.4.1.08","B2.4.1.10","B2.4.1.11","B2.4.1.99","B2.4.1a","B2.5","B2.6","B2.7","B2.8","B2.9","B3.1","B3.2","B3.3","B3.4","B3.5","B4.01","B4.01.1","B4.01.2","B4.02","B4.03","B4.04","B4.05.1","B4.05.2","B4.06","B4.07","B4.08","B4.09","B4.10","B5.0","B6.0","C0.0","C0.1.E","C0.1.F","C0.1.O","C0.1.T","C0.2.E","C0.2.F","C0.2.O","C0.2.T","C0.3","C0.3.1.E","C0.3.1.F","C0.3.1.O","C0.3.1.T","C0.3.2.E","C0.3.2.F","C0.3.2.O","C0.3.2.T","C0.3.3.E","C0.3.3.F","C0.3.3.O","C0.3.3.T","C0.3.4.E","C0.3.4.F","C0.3.4.O","C0.3.4.T","C0.4.E","C0.4.F","C0.4.O","C0.4.T","C0.5.E","C0.5.F","C0.5.O","C0.5.T","C3.0","C3.1.E","C3.1.F","C3.1.O","C3.1.T","C3.2","C3.2.0.E","C3.2.0.F","C3.2.0.O","C3.2.0.T","C3.2.4.E","C3.2.4.F","C3.2.4.O","C3.2.4.T","C4.0","C4.1","C4.1","C4.1","C4.2","C4.3","C4.3.02","C4.3.03","C4.3.04","C4.3.05","C4.3.06","C4.3.07","C4.3.08","C4.3.09","C5.0","C5.1","C5.2","C5.3","D1.0.H","D1.1.1.C","D1.1.2.C","D1.1.3.1.C","D1.1.3.C","D1.1.4.C","D1.1.5.C","D1.2.1.C","D1.2.1.H","D1.2.2.C","D1.2.2.H","D1.2.3.1.C","D1.2.3.1.H","D1.2.3.C","D1.2.3.H","D1.2.4.C","D1.2.4.H","D1.2.5.C","D1.2.5.H","D1.3","D1.3.1","E1.1","E1.1.1","E1.1.2","E1.1.4","E1.2","E2.1","E2.3","E2.4","E2.4","E2.4","E2.5","E2.6","E2.6","E2.6","E2.7","E2.8","E3.1.SPC","E3.1.SPH","E3.2.SPC","E3.2.SPH","E3.3.SPC","E3.3.SPH","E3.4.SPC","E3.4.SPH","E3.5.SPC","E3.5.SPH","E3.6.SPC","F1.0","F2.1.P","F2.2.A","F2.301.Attendance","F2.301.Programs","F2.302.Attendance","F2.302.Programs","F2.303.Attendance","F2.303.Programs","F2.304.Attendance","F2.304.Programs","F2.305.Attendance","F2.305.Programs","F2.306.Attendance","F2.306.Programs","F2.307.Attendance","F2.307.Programs","F2.308.Attendance","F2.308.Programs","F2.309.Attendance","F2.309.Programs","F2.310.Attendance","F2.310.Programs","F2.311.Attendance","F2.311.Programs","F2.312","F2.312","F2.313.Attendance","F2.313.Programs","F2.314.Attendance","F2.314.Programs","F2.315.Attendance","F2.315.Programs","F2.316.Attendance","F2.316.Programs","F2.317.Attendance","F2.317.Programs","F2.318.Attendance","F2.318.Programs","F2.319.Attendance","F2.319.Programs","F2.320.Attendance","F2.320.Programs","F2.321.Attendance","F2.321.Programs","F2.322.Attendance","F2.322.Programs","F2.4","F2.4.1","F3.1.1","F3.1.2","F3.2.1","F3.2.2","G1.1.1.W","G1.1.2.W","G1.1.3.W","G1.2.1.W","G1.3.1.W","G1.3.2.W","G1.3.3.W","G1.3.4","G1.4.1.W","G1.4.2.W","G1.4.3.W","G1.4.4.W","G1.4.5.W","G1.4.6.W","G1.5.1.W","G1.5.2.W","G1.5.3.W","H1.1.1.01","H1.1.1.02","H1.1.1.03","H1.1.1.04","H1.1.1.05","H1.1.1.06","H1.1.1.07","H1.1.1.08","H1.1.1.92","H1.2.1.F","H1.2.1.T","H1.2.2","H1.3.1.F","H1.3.1.T","H1.3.2.11","H1.3.2.12","H1.3.2.13","H1.3.2.14","H1.3.2.15","H1.3.2.16","H1.3.2.17","H1.3.2.18","H1.3.2.19","H1.3.2.20","H1.3.2.90","H1.4.1.F","H1.4.1.T","H1.4.2","H1.4.3.21","H1.4.3.22","H1.4.3.23","H1.4.3.24","H1.4.3.25","H1.4.3.26","H1.4.3.93","H1.5.1.F","H1.5.1.T","H1.5.2","H1.5.3.40","H1.5.3.41","H1.5.3.42","H1.5.3.43","H1.5.3.44","H1.5.3.94","H1.5.4","H1.7.1.F","H1.7.1.T","H1.7.2.31","H1.7.2.32","H1.7.2.34","H1.7.2.35","H1.7.2.36","H1.7.2.91","H1.8.1.F","H1.8.1.T","H1.8.2.PC","H1.8.3.F","H1.8.3.T","H1.8.4.TN","H1.9.1.F","H1.9.1.T","H1.9.2.51","H1.9.2.52","H1.9.2.95","P1.1","P1.2","P2.1","P2.2"),
"oldformat"=temp3,stringsAsFactors = F)
#rename the old data fields with short versions of the new field names (to be generated later on), where possible
names(libraries2000_2010)[names(libraries2000_2010) %in% names_lookup$oldformat]<-as.character(names_lookup$abbreviate[match(names(libraries2000_2010)[names(libraries2000_2010) %in% names_lookup$oldformat],names_lookup$oldformat)])
#convert column E2.1 to an integer for consistency with more recent data format
libraries2000_2010$E2.1[libraries2000_2010$E2.1=="Yes"]<-1
libraries2000_2010$E2.1[libraries2000_2010$E2.1=="No"]<-0
libraries2000_2010$E2.1<-as.integer(libraries2000_2010$E2.1)
#get list of long field names
longnames<-c(names(ontario_library_stats_2011),setdiff(names(ontario_library_stats_2012),names(ontario_library_stats_2011)))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2013),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2014),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2015),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2016),longnames))
#shorten the column names for data from 2011-2016
names(ontario_library_stats_2011)[4:length(names(ontario_library_stats_2011))]<-sapply(strsplit(names(ontario_library_stats_2011)[4:length(names(ontario_library_stats_2011))], " "), "[", 1)
names(ontario_library_stats_2012)[4:length(names(ontario_library_stats_2012))]<-sapply(strsplit(names(ontario_library_stats_2012)[4:length(names(ontario_library_stats_2012))], " "), "[", 1)
names(ontario_library_stats_2013)[4:length(names(ontario_library_stats_2013))]<-sapply(strsplit(names(ontario_library_stats_2013)[4:length(names(ontario_library_stats_2013))], " "), "[", 1)
names(ontario_library_stats_2014)[4:length(names(ontario_library_stats_2014))]<-sapply(strsplit(names(ontario_library_stats_2014)[4:length(names(ontario_library_stats_2014))], " "), "[", 1)
names(ontario_library_stats_2015)[4:length(names(ontario_library_stats_2015))]<-sapply(strsplit(names(ontario_library_stats_2015)[4:length(names(ontario_library_stats_2015))], " "), "[", 1)
names(ontario_library_stats_2016)[4:length(names(ontario_library_stats_2016))]<-sapply(strsplit(names(ontario_library_stats_2016)[4:length(names(ontario_library_stats_2016))], " "), "[", 1)
#produce lookup table for short names vs. long names
new_names_lookup<-data.frame(full_names=longnames,short_names=c(longnames[1:3],sapply(strsplit(longnames[4:length(longnames)], " "), "[", 1)))
#merge library data from 2011-2016
libraries2011_2016<-bind_rows(ontario_library_stats_2011,
ontario_library_stats_2012,
ontario_library_stats_2013,
ontario_library_stats_2014,
ontario_library_stats_2015,
ontario_library_stats_2016)
#convert library number to integer for consistency with older years data
libraries2011_2016$`Library Number`<-as.integer(substr(libraries2011_2016$`Library Number`,2,5))
#merge the library data from 2000-2010 and 2011-2016
libraries2000_2016<-bind_rows(libraries2000_2010,libraries2011_2016)
#aggregate(sum) library data by city and year
libraries2000_2016_by_city<-libraries2000_2016[,-c(1:2,4:8,10:12,17:19,22,114,158)] %>% group_by(`Survey Year From`,A1.10) %>% summarise_all(sum)
#replace the original full field names
names(libraries2000_2016_by_city)[names(libraries2000_2016_by_city) %in% new_names_lookup$short_names]<-as.character(new_names_lookup$full_names[match(names(libraries2000_2016_by_city)[names(libraries2000_2016_by_city) %in% new_names_lookup$short_names],new_names_lookup$short_names)])
#I haven't removed any unnecessary columns or combined any columns because you may which to use the data as-is for Assignment 3 (it's your call)
install.packages("tidyverse")
library(tidyverse)
install.packages(c("nycflights13", "gapminder", "lahman"))
ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_wrap(~ class, nrow = 2)
ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_grid(drv ~ .)
ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_grid(. ~ cyl)
ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy))
ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_wrap(~ class, nrow = 2)
ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(. ~ cyl)
ggplot(data = mpg) + geom_smooth(mapping = aes(x = displ, y = hwy))
ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))
ggplot(data = mpg) + geom_smooth(mapping = aes(x = displ, y = hwy, color = drv), show.legend = FALSE)
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(mapping = aes(color = class)) +
geom_smooth()
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(mapping = aes(color = class)) +
geom_smooth(data = filter(mpg, class == "subcompact"), se = FALSE)
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut))
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, fill = clarity))
nz <- map_data("nz")
bar <- ggplot(data = diamonds) +
geom_bar(
mapping = aes(x = cut, fill = cut),
show.legend = FALSE,
width = 1
) +
theme(aspect.ratio = 1) +
labs(x = NULL, y = NULL)
bar + coord_flip()
bar + coord_polar()
filter(flights, month == 1, day == 1)
flights
nycflights13::flights
flights
view(flights)
view(nycflights13::flights)
arrange(nycflights13::flights, year, month, day)
x <- tribble(
~key, ~val_x,
1, "x1",
2, "x2",
3, "x3"
x <- tribble(
~key, ~val_x,
1, "x1",
2, "x2",
3, "x3"
)
ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut))
library(ggplot2)
ggplot2(data = diamonds) + geom_bar(mapping = aes(x = cut))
ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut))
diamonds %>%
count(cut)
dplyr::count()
ggplot2(data = diamonds2, mapping = aes(x = x, y = y)) + geom_point()
ggplot(data = diamonds2, mapping = aes(x = x, y = y)) + geom_point()
ggplot2(data = diamonds, mapping = aes(x = x, y = y)) + geom_point()
ggplot(data = diamonds, mapping = aes(x = x, y = y)) + geom_point()
ggplot(data = diamonds, mapping = aes(x = x, y = y)) + geom_point()
ggplot(data = diamonds) +
geom_count(mapping = aes(x = cut, y = color))
diamonds %>%
count(color, cut) %>%
ggplot(mapping = aes(x = color, y = cut)) +
geom_tile(mapping = aes(fill = n))
diamonds %>%
count(cut, clarity) %>%
ggplot(aes(clarity, cut, fill = n)) +
geom_tile()
wine <- read.table("http://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data",
sep=",")
wine
library(car)
library("car")
install.packages("car")
wine[2:6]
wine[4:5]
scatterplot(wine[2:6])
scatterplotMatrix(wine[2:6])
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
scatterplotMatrix(wine[2:6])
data("iris")
data(iris)
pairs(~Sepal.Length+Sepal.Width+Petal.Length+Petal.Width, data=iris)
wine[2:6]
wine <- read.table("http://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data",
sep=",")
wine[2:6]
scatterplotMatrix(wine[2:6])
library("car")
scatterplotMatrix(wine[2:6])
cars
scatterplotMatrix(wine[2:6])
plot(wine$v4, wine$v5)
plot(wine$V4, wine$V5)
text(wine$V4, wine$V5, wine$V1, cex=0.7, pos=4, col="red")
sapply(wine[2:14],mean)
wine
# Assignment #3 script March 21
#
#1 Produces an output that shows me which libraries are most similar to which other libraries
#2 Produces an output that can predict the ratio of the number of active library cardholders relative to the resident population served
# This portion of the script wrangles the data for the analysis section below
#install packages if not already installed
#install.packages("readr")
#instal.packages("dplyr")
#install.packages("RColorBrewer")
#load readr package for importing data files
library(readr)
#load dplyr package for manipulating data
library("dplyr")
#set working directory to the location where your data files are stored
#setwd("enter the file path here")
setwd("E:/school/University.Guelph/8020001 - Introduction to Data Science/Assignments/Assignment 3/data18")
#import each data file - and assign to a variable
ontario_library_stats_1999 <- read_csv("ontario_library_stats_1999.csv")
ontario_library_stats_2000 <- read_csv("ontario_library_stats_2000.csv")
ontario_library_stats_2001 <- read_csv("ontario_library_stats_2001.csv")
ontario_library_stats_2002 <- read_csv("ontario_library_stats_2002.csv")
ontario_library_stats_2003 <- read_csv("ontario_library_stats_2003.csv")
ontario_library_stats_2004 <- read_csv("ontario_library_stats_2004.csv")
ontario_library_stats_2005 <- read_csv("ontario_library_stats_2005.csv")
ontario_library_stats_2006 <- read_csv("ontario_library_stats_2006.csv")
ontario_library_stats_2007 <- read_csv("ontario_library_stats_2007.csv")
ontario_library_stats_2008 <- read_csv("ontario_library_stats_2008.csv")
ontario_library_stats_2009 <- read_csv("ontario_library_stats_2009.csv")
ontario_library_stats_2010 <- read_csv("ontario_library_stats_2010.csv")
ontario_library_stats_2011 <- read_csv("ontario_public_library_statistics_2011_open_data_may_22_csv_final.csv")
ontario_library_stats_2012 <- read_csv("ontario_public_library_statistics_2012_open_data_may_22_2015_csv_final_9.csv")
ontario_library_stats_2013 <- read_csv("ontario_public_library_statistics_2013_open_data_may_22_2015_csv_final.csv")
ontario_library_stats_2014 <- read_csv("ontario_public_library_statistics_2014_open_data_csv_february_17_2016.csv",skip=1) #first row needs to be skipped to import headers properly
ontario_library_stats_2015 <- read_csv("2015_ontario_public_library_statistics_open_data_dec_2017rev.csv")
ontario_library_stats_2016 <- read_csv("ontario_public_library_statistics_open_data_2016.csv")
#ignore 1999 data file - it's too much of a mess
#rename column 1 of 2000 data file for consistency with 2001-2010
names(ontario_library_stats_2000)[names(ontario_library_stats_2000)=="0"]<-"LibID"
#merge library data from 2000-2010
libraries2000_2010<-bind_rows(ontario_library_stats_2000,
ontario_library_stats_2001,
ontario_library_stats_2002,
ontario_library_stats_2003,
ontario_library_stats_2004,
ontario_library_stats_2005,
ontario_library_stats_2006,
ontario_library_stats_2007,
ontario_library_stats_2008,
ontario_library_stats_2009,
ontario_library_stats_2010)
# Uncomment if you need to see the file in Excel
write.csv(libraries2000_2010, "merged/libraries2000_2010.csv")
#sum titles held
libraries2000_2010$`Titles Held (Total - English Language)`<-libraries2000_2010$`Titles Held (Circulating - English Language)`+libraries2000_2010$`Titles Held (Reference - English Language)`
libraries2000_2010$`Titles Held (Total - French Language)`<-libraries2000_2010$`Titles Held (Circulating - French Language)`+libraries2000_2010$`Titles Held (Reference - French Language)`
libraries2000_2010$`Titles Held (Total - Other Language)`<-libraries2000_2010$`Titles Held (Circulating - Other Language)`+libraries2000_2010$`Titles Held (Reference - Other Language)`
#sum Volumes held
libraries2000_2010$`Volumes Held (Total - English Language)`<-libraries2000_2010$`Volumes Held (Circulating - English Language)`+libraries2000_2010$`Volumes Held (Reference - English Language)`
libraries2000_2010$`Volumes Held (Total - French Language)`<-libraries2000_2010$`Volumes Held (Circulating - French Language)`+libraries2000_2010$`Volumes Held (Reference - French Language)`
libraries2000_2010$`Volumes Held (Total - Other Language)`<-libraries2000_2010$`Volumes Held (Circulating - Other Language)`+libraries2000_2010$`Volumes Held (Reference - Other Language)`
#sum CDs
libraries2000_2010$`# of CD ROM Titles (Total - English Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - English Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - English Language)`+libraries2000_2010$`# of CD ROM Titles (Periodicals - English Language)`
libraries2000_2010$`# of CD ROM Titles (Total - French Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - French Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - French Language)`+libraries2000_2010$`# of CD ROMs Titles (Periodicals - French Language)`
libraries2000_2010$`# of CD ROM Titles (Total - Other Language)`<-libraries2000_2010$`# of CD ROM Titles (Circulating - Other Language)`+libraries2000_2010$`# of CD ROM Titles (Reference - Other Language)`+libraries2000_2010$`# of CD ROM Titles (Periodicals - Other Language)`
#sum CD copies
libraries2000_2010$`# of copies of CD ROMs (Total - English Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - English Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - English Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - English Language)`
libraries2000_2010$`# of copies of CD ROMs (Total - French Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - French Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - French Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - French Language)`
libraries2000_2010$`# of copies of CD ROMs (Total - Other Language)`<-libraries2000_2010$`# of copies of CD ROMs (Circulating - Other Language)`+libraries2000_2010$`# of copies of CD ROM (Reference - Other Language)`+libraries2000_2010$`# of copies of CD ROMs (Periodicals - Other Language)`
#sum databases and subscriptions
libraries2000_2010$`# of Databases (Total - English Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - English Language)`+libraries2000_2010$`# of Databases (Reference - English Language)`
libraries2000_2010$`# of Databases (Total - French Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - French Language)`+libraries2000_2010$`# of Databases (Reference - French Language)`
libraries2000_2010$`# of Databases (Total - Other Language)`<-libraries2000_2010$`# of Database Subscriptions (Periodicals - Other Language)`+libraries2000_2010$`# of Databases (Reference - Other Language)`
#manually generated field mapping between old and new data format (this was a real pain to make)
temp<-c("Library","LibID","Year","Ontario Library Service (OLS) Region","Library Service Type","Mailing Address","Street Address","City",NA,"Postal Code","Library Web Site Address","# of Active Library Cardholders","Net Balance brought forward amount",NA,NA,NA,"Provincial Operating Funding","Local Operating Grant","Contract Revenue",NA,NA,NA,NA,NA,NA,NA,NA,NA,"Project Grants","Donations","Self-generated Revenue","Debt Services and Reserve Fund Revenues","Other operating revenue","Total Operating Revenues","Provincial capital revenues","Federal capital revenues","Local capital revenues","Other capital revenues","Total Capital Revenues",NA,"General materials expenditure","Electronic materials expenditure","Staffing expenditure","Staff Training expenditure","Facilities/Utilities","Telephone and Fax","Dedicated Internet Connectivity Costs","Computer Services","Debt Charges and Transfers to Reserve Funds","Funds returned to government sources","Contract payment made to library boards for library services","Other expenditures","Total Operating Expenditures","Total Capital Expenditures",NA,"Titles Held (Total - English Language)","Titles Held (Total - French Language)","Titles Held (Total - Other Language)",NA,"Volumes Held (Total - English Language)","Volumes Held (Total - French Language)","Volumes Held (Total - Other Language)",NA,NA,"# of CD ROM Titles (Total - English Language)","# of CD ROM Titles (Total - French Language)","# of CD ROM Titles (Total - Other Language)",NA,"# of copies of CD ROMs (Total - English Language)","# of copies of CD ROMs (Total - French Language)","# of copies of CD ROMs (Total - Other Language)",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"Titles Held (Periodicals - English Language)","Titles Held (Periodicals - French Language)","Titles Held (Periodicals - Other Language)",NA,NA,"# of Databases (Total - English Language)","# of Databases (Total - French Language)","# of Databases (Total - Other Language)",NA,"# of individual electronic periodical titles (English Language)","# of individual electronic periodical titles (French Language)","# of individual electronic periodical titles (Other Language)",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of hours per week in an FTE","Librarians (Full Time - # of people)","Library Technicians (Full Time - # of people)",NA,"EXCEL Graduates  (Full Time - # of people)","Other staff (Full Time - # of people)","Volunteers (Full Time - # of people)","Librarians (Part Time - # of people)","Librarians (Part Time - Hours worked)","Library Technicians (Part Time - # of people)","Library Technicians (Part Time - Hours worked)",NA,NA,"EXCEL Graduates (Part Time - # of people)","EXCEL Graduates (Part Time - Hours worked)","Other staff (Part Time - # of people)","Other staff (Part Time - Hours worked)","Volunteers (Part Time - # of people)","Volunteers (Part Time - Hours worked)",NA,NA,"# of Public access workstations")
temp2<-c("Workstations with internet access","Workstations with OPAC access",NA,NA,"Automated catalogue available","Does your library provide wireless Internet connection",NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of Main Libraries","Main Library - total hours open per week","# of Branches open >= 12 hours per week","Branches open >= 12 hours per week - total hours open per week","# of Branches open < 12 hours per week","Branches open < 12 hours per week - total hours open per week","# of Bookmobile stops","Bookmobile hours per week","# of Deposit Stations","Deposit Station hours per week","# of Bookmobiles","Total Annual Direct Circulation","# of programs held annually","Annual program attendance",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"# of requests made to other libraries","# of items borrowed","# of requests received from other libraries","# of items lent","Typical Week - Direct circulation",NA,NA,"Typical Week - Materials use in library","Typical Week -  # of people using library workstations","Typical Week -  # of times electronic databases accessed","No of people using public library wireless connection",NA,"Typical Week -  # of standard reference transactions","Typical Week -  # of electronic reference transactions",NA,NA,NA,NA,"Typical Week -  # of library visits made in person","Typical Week -  # of electronic library visits",NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,"Population (Resident)","Population (Contracting)","Households (Contracting)","Households (Resident)")
temp3<-c(temp,temp2)
names_lookup<-data.frame("abbreviated"=c("Library Full Name","Library Number","Survey Year From","A1.3","A1.4","A1.5","A1.9","A1.10","A1.11","A1.12","A1.13","A1.14","B1.1","B2.1.1","B2.1.2","B2.1.3","B2.1.4","B2.2","B2.3","B2.4.1.02","B2.4.1.03","B2.4.1.04","B2.4.1.05","B2.4.1.07","B2.4.1.08","B2.4.1.10","B2.4.1.11","B2.4.1.99","B2.4.1a","B2.5","B2.6","B2.7","B2.8","B2.9","B3.1","B3.2","B3.3","B3.4","B3.5","B4.01","B4.01.1","B4.01.2","B4.02","B4.03","B4.04","B4.05.1","B4.05.2","B4.06","B4.07","B4.08","B4.09","B4.10","B5.0","B6.0","C0.0","C0.1.E","C0.1.F","C0.1.O","C0.1.T","C0.2.E","C0.2.F","C0.2.O","C0.2.T","C0.3","C0.3.1.E","C0.3.1.F","C0.3.1.O","C0.3.1.T","C0.3.2.E","C0.3.2.F","C0.3.2.O","C0.3.2.T","C0.3.3.E","C0.3.3.F","C0.3.3.O","C0.3.3.T","C0.3.4.E","C0.3.4.F","C0.3.4.O","C0.3.4.T","C0.4.E","C0.4.F","C0.4.O","C0.4.T","C0.5.E","C0.5.F","C0.5.O","C0.5.T","C3.0","C3.1.E","C3.1.F","C3.1.O","C3.1.T","C3.2","C3.2.0.E","C3.2.0.F","C3.2.0.O","C3.2.0.T","C3.2.4.E","C3.2.4.F","C3.2.4.O","C3.2.4.T","C4.0","C4.1","C4.1","C4.1","C4.2","C4.3","C4.3.02","C4.3.03","C4.3.04","C4.3.05","C4.3.06","C4.3.07","C4.3.08","C4.3.09","C5.0","C5.1","C5.2","C5.3","D1.0.H","D1.1.1.C","D1.1.2.C","D1.1.3.1.C","D1.1.3.C","D1.1.4.C","D1.1.5.C","D1.2.1.C","D1.2.1.H","D1.2.2.C","D1.2.2.H","D1.2.3.1.C","D1.2.3.1.H","D1.2.3.C","D1.2.3.H","D1.2.4.C","D1.2.4.H","D1.2.5.C","D1.2.5.H","D1.3","D1.3.1","E1.1","E1.1.1","E1.1.2","E1.1.4","E1.2","E2.1","E2.3","E2.4","E2.4","E2.4","E2.5","E2.6","E2.6","E2.6","E2.7","E2.8","E3.1.SPC","E3.1.SPH","E3.2.SPC","E3.2.SPH","E3.3.SPC","E3.3.SPH","E3.4.SPC","E3.4.SPH","E3.5.SPC","E3.5.SPH","E3.6.SPC","F1.0","F2.1.P","F2.2.A","F2.301.Attendance","F2.301.Programs","F2.302.Attendance","F2.302.Programs","F2.303.Attendance","F2.303.Programs","F2.304.Attendance","F2.304.Programs","F2.305.Attendance","F2.305.Programs","F2.306.Attendance","F2.306.Programs","F2.307.Attendance","F2.307.Programs","F2.308.Attendance","F2.308.Programs","F2.309.Attendance","F2.309.Programs","F2.310.Attendance","F2.310.Programs","F2.311.Attendance","F2.311.Programs","F2.312","F2.312","F2.313.Attendance","F2.313.Programs","F2.314.Attendance","F2.314.Programs","F2.315.Attendance","F2.315.Programs","F2.316.Attendance","F2.316.Programs","F2.317.Attendance","F2.317.Programs","F2.318.Attendance","F2.318.Programs","F2.319.Attendance","F2.319.Programs","F2.320.Attendance","F2.320.Programs","F2.321.Attendance","F2.321.Programs","F2.322.Attendance","F2.322.Programs","F2.4","F2.4.1","F3.1.1","F3.1.2","F3.2.1","F3.2.2","G1.1.1.W","G1.1.2.W","G1.1.3.W","G1.2.1.W","G1.3.1.W","G1.3.2.W","G1.3.3.W","G1.3.4","G1.4.1.W","G1.4.2.W","G1.4.3.W","G1.4.4.W","G1.4.5.W","G1.4.6.W","G1.5.1.W","G1.5.2.W","G1.5.3.W","H1.1.1.01","H1.1.1.02","H1.1.1.03","H1.1.1.04","H1.1.1.05","H1.1.1.06","H1.1.1.07","H1.1.1.08","H1.1.1.92","H1.2.1.F","H1.2.1.T","H1.2.2","H1.3.1.F","H1.3.1.T","H1.3.2.11","H1.3.2.12","H1.3.2.13","H1.3.2.14","H1.3.2.15","H1.3.2.16","H1.3.2.17","H1.3.2.18","H1.3.2.19","H1.3.2.20","H1.3.2.90","H1.4.1.F","H1.4.1.T","H1.4.2","H1.4.3.21","H1.4.3.22","H1.4.3.23","H1.4.3.24","H1.4.3.25","H1.4.3.26","H1.4.3.93","H1.5.1.F","H1.5.1.T","H1.5.2","H1.5.3.40","H1.5.3.41","H1.5.3.42","H1.5.3.43","H1.5.3.44","H1.5.3.94","H1.5.4","H1.7.1.F","H1.7.1.T","H1.7.2.31","H1.7.2.32","H1.7.2.34","H1.7.2.35","H1.7.2.36","H1.7.2.91","H1.8.1.F","H1.8.1.T","H1.8.2.PC","H1.8.3.F","H1.8.3.T","H1.8.4.TN","H1.9.1.F","H1.9.1.T","H1.9.2.51","H1.9.2.52","H1.9.2.95","P1.1","P1.2","P2.1","P2.2"),
"oldformat"=temp3,stringsAsFactors = F)
#rename the old data fields with short versions of the new field names (to be generated later on), where possible
names(libraries2000_2010)[names(libraries2000_2010) %in% names_lookup$oldformat]<-as.character(names_lookup$abbreviate[match(names(libraries2000_2010)[names(libraries2000_2010) %in% names_lookup$oldformat],names_lookup$oldformat)])
#convert column E2.1 to an integer for consistency with more recent data format
libraries2000_2010$E2.1[libraries2000_2010$E2.1=="Yes"]<-1
libraries2000_2010$E2.1[libraries2000_2010$E2.1=="No"]<-0
libraries2000_2010$E2.1<-as.integer(libraries2000_2010$E2.1)
#get list of long field names
longnames<-c(names(ontario_library_stats_2011),setdiff(names(ontario_library_stats_2012),names(ontario_library_stats_2011)))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2013),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2014),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2015),longnames))
longnames<-c(longnames,setdiff(names(ontario_library_stats_2016),longnames))
#shorten the column names for data from 2011-2016
names(ontario_library_stats_2011)[4:length(names(ontario_library_stats_2011))]<-sapply(strsplit(names(ontario_library_stats_2011)[4:length(names(ontario_library_stats_2011))], " "), "[", 1)
names(ontario_library_stats_2012)[4:length(names(ontario_library_stats_2012))]<-sapply(strsplit(names(ontario_library_stats_2012)[4:length(names(ontario_library_stats_2012))], " "), "[", 1)
names(ontario_library_stats_2013)[4:length(names(ontario_library_stats_2013))]<-sapply(strsplit(names(ontario_library_stats_2013)[4:length(names(ontario_library_stats_2013))], " "), "[", 1)
names(ontario_library_stats_2014)[4:length(names(ontario_library_stats_2014))]<-sapply(strsplit(names(ontario_library_stats_2014)[4:length(names(ontario_library_stats_2014))], " "), "[", 1)
names(ontario_library_stats_2015)[4:length(names(ontario_library_stats_2015))]<-sapply(strsplit(names(ontario_library_stats_2015)[4:length(names(ontario_library_stats_2015))], " "), "[", 1)
names(ontario_library_stats_2016)[4:length(names(ontario_library_stats_2016))]<-sapply(strsplit(names(ontario_library_stats_2016)[4:length(names(ontario_library_stats_2016))], " "), "[", 1)
#produce lookup table for short names vs. long names
new_names_lookup<-data.frame(full_names=longnames,short_names=c(longnames[1:3],sapply(strsplit(longnames[4:length(longnames)], " "), "[", 1)))
#merge library data from 2011-2016
libraries2011_2016<-bind_rows(ontario_library_stats_2011,
ontario_library_stats_2012,
ontario_library_stats_2013,
ontario_library_stats_2014,
ontario_library_stats_2015,
ontario_library_stats_2016)
# Uncomment if you need to see the file in Excel
write.csv(libraries2011_2016, "merged/libraries2011_2016.csv")
#convert library number to integer for consistency with older years data
libraries2011_2016$`Library Number`<-as.integer(substr(libraries2011_2016$`Library Number`,2,5))
#merge the library data from 2000-2010 and 2011-2016
libraries2000_2016<-bind_rows(libraries2000_2010,libraries2011_2016)
# Uncomment if you need to see the file in Excel
write.csv(libraries2000_2016, "merged/libraries2000_2016.csv")
#aggregate(sum) library data by city and year
libraries2000_2016_by_city<-libraries2000_2016[,-c(1:2,4:8,10:12,17:19,22,114,158)] %>% group_by(`Survey Year From`,A1.10) %>% summarise_all(sum)
#replace the original full field names
names(libraries2000_2016_by_city)[names(libraries2000_2016_by_city) %in% new_names_lookup$short_names]<-as.character(new_names_lookup$full_names[match(names(libraries2000_2016_by_city)[names(libraries2000_2016_by_city) %in% new_names_lookup$short_names],new_names_lookup$short_names)])
# Uncomment if you need to see the file in Excel
write.csv(libraries2000_2016_by_city, "merged/libraries2000_2016_by_city.csv")
#I haven't removed any unnecessary columns or combined any columns because you may which to use the data as-is for Assignment 3 (it's your call)
###### End ######
###### BEGIN Aaron Assignment #3 ######
# PART 1
# 1 Produces an output that shows me which libraries are most similar to which other libraries
# Update 03/21/2018
# Similar libraries are identified by having similar values in common signigicant attributes
# Variable/column weighting should be considered
# aggregate(mean, sd) library data by library - UNFILTERED
# libraries2000_2016_by_library_mean <-libraries2000_2016[,-c(1,3,4:8,10:12,17:19,22,114,158)] %>% group_by(`Library Full Name`) %>% summarise_all(mean)
# libraries2000_2016_by_library_sd <-libraries2000_2016[,-c(1,3,4:8,10:12,17:19,22,114,158)] %>% group_by(`Library Full Name`) %>% summarise_all(sd)
# Filter data
# Survey Year - 2000
# B2.1.4 - Total Provincial Operating Funding   - This was used because it was easy to find a sample size of ~ 20.
mylist <-filter(libraries2000_2016, `B2.1.4` > 230000 & `Survey Year From` == 2000)
# Select columns for sample
mylist <-select(mylist, `Library Full Name`, `A1.4`, `A1.14`, `B1.1`, `B2.1.4`, `B2.2`, `B2.3`, `B2.4.1a`, `B2.5`, `B2.6`, `B3.1`, `B3.3`, `B3.5`, `B5.0`, `D1.1.1.C`, `E1.1`, `F2.1.P`, `F3.1.2`, `G1.1.1.W`, `P1.1`, `P1.2`, `P2.1`, `P2.2`)
# Replace the original full field names
names(mylist)[names(mylist) %in% new_names_lookup$short_names]<-as.character(new_names_lookup$full_names[match(names(mylist)[names(mylist) %in% new_names_lookup$short_names],new_names_lookup$short_names)])
# Write the datatable to a file (mylist - 20x20 sample data)
write.csv(mylist, "merged/mylist.csv")
# Start PCA #
# Standardize variables - getting NaN for a column that has all zeros.  I would not expect a 'not a number' error when doing math on a 0
stdValuesList <- as.data.frame(scale(mylist[3:23]))
# Check and write std list to a file
write.csv(stdValuesList, "merged/stdValuesList.csv")
# PCA with prcomp()
library.pca <- prcomp(stdValuesList)
# Summarize the PCA
summary(library.pca)
# Display standard deviation
library.pca$sdev
# Display total variance = total number of variables
sum((library.pca$sdev)^2)
# Display in a screenplot - to decide what to keep for Principal components (first 3)
screeplot(library.pca, type="lines")
# Principal component selection using Kaiser's (first 3)
(library.pca$sdev)^2
# obtain loadings - first 3
library.pca$rotation[, 1]
library.pca$rotation[, 2]
library.pca$rotation[, 3]
library.pca$x[,1]
library.pca$x[,2]
library.pca$x[,3]
# Scatterplot all 3 combinations
plot(library.pca$x[,1],library.pca$x[,2])
plot(library.pca$x[,1],library.pca$x[,3])
plot(library.pca$x[,2],library.pca$x[,3])
text(library.pca$x[,1],library.pca$x[,2], mylist$`A1.14 - No. of Active Library Cardholders`, cex=0.7, pos=4, col="red")
## Determine what is useful for finding similarity ##
## This part of clustering and segmentation needs work ##
## Contrast/Separate ##
# PART 2
# 2 Produces an output that can predict the ratio of the number of active library cardholders relative to the resident population served
# I understood this to be a detection of variables that have positive relationships.  ScatterplotMatrix(cardholder2population) / predict() are used.
# ScatterplotMatrix our dataframe
library("car")
library("ggplot2")
library("MASS")
# Below code provided by Dr. Joe Mudge / updated by Aaron Toth
# I believe my approach would have been to find separation
# Calculate the cardholder/population ratio:
mylist$cpratio<-mylist$`P1.1 - Resident Population Served`/mylist$`A1.14 - No. of Active Library Cardholders`
# Model
predict.cpratio<-lm(cpratio~ mylist$`B2.2 - Local Operating Funding (e.g. Municipality or Band local operating funding)`, data=mylist[is.finite(mylist$cpratio)==T,])
# Display model results
summary(predict.cpratio)
#plot the data and add a model line
plot(mylist$`B2.2 - Local Operating Funding (e.g. Municipality or Band local operating funding)`, mylist$cpratio)
abline(predict.cpratio)
text(library.pca$x[,1],library.pca$x[,2], mylist$`A1.14 - No. of Active Library Cardholders`, cex=0.7, pos=4, col="red")
plot(library.pca$x[,1],library.pca$x[,2])
library(ggplot2)
library(dplyr)
knitr::opts_chunk$set(echo = TRUE)
plot(library.pca$x[,1],library.pca$x[,2])
library(ggplot2)
library(dplyr)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
knitr::opts_chunk$set(echo = TRUE)
plot(mylist$`B2.2 - Local Operating Funding (e.g. Municipality or Band local operating funding)`, mylist$cpratio)
abline(predict.cpratio)
plot(library.pca$x[,1],library.pca$x[,2])
plot(library.pca$x[,1],library.pca$x[,2])
plot(library.pca$x[,1],library.pca$x[,2])
plot(mylist$`B2.2 - Local Operating Funding (e.g. Municipality or Band local operating funding)`, mylist$cpratio)
abline(predict.cpratio)
plot(library.pca$x[,1],library.pca$x[,2])
plot(library.pca$x[,1],library.pca$x[,2])
plot(mylist$`B2.2 - Local Operating Funding (e.g. Municipality or Band local operating funding)`, mylist$cpratio)
abline(predict.cpratio)
View(library.pca)
